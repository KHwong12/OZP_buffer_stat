import{bM as xt,bv as mt,br as ut,c$ as P,a6 as wt,e as E,aB as Lt,d0 as V,m as rt,cz as It,c8 as $t,c5 as Xt}from"./index.9da382e4.js";import{t as At,a as zt,A as pt,x as Rt,r as yt,Z as R,c as j,i as z,M as C,o as Jt,d as Ht,e as bt,p as Yt,C as Et}from"./CIMSymbolHelper.e0e771f8.js";import{f as it,e as tt,c as et}from"./enums.05a6ea95.js";import{o as Ft}from"./floatRGBA.b2358e75.js";import{s as Z}from"./callExpressionWithFeature.620cb82f.js";import{d as Tt}from"./definitions.6dca4f7b.js";function Wt(t){var o;if(!t)return null;switch(t.type){case"CIMPointSymbol":{const e=t.symbolLayers;return e&&e.length===1?Wt(e[0]):null}case"CIMVectorMarker":{const e=t.markerGraphics;if(!e||e.length!==1)return null;const r=e[0];if(!r)return null;const i=r.geometry;if(!i)return null;const l=r.symbol;return!l||l.type!=="CIMPolygonSymbol"&&l.type!=="CIMLineSymbol"||((o=l.symbolLayers)==null?void 0:o.some(a=>!!a.effects))?null:{geom:i,asFill:l.type==="CIMPolygonSymbol"}}case"sdf":return{geom:t.geom,asFill:t.asFill}}return null}function Dt(t){return t?t.rings?t.rings:t.paths?t.paths:t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0?[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]:null:null}function Gt(t){let o=1/0,e=-1/0,r=1/0,i=-1/0;for(const l of t)for(const a of l)a[0]<o&&(o=a[0]),a[0]>e&&(e=a[0]),a[1]<r&&(r=a[1]),a[1]>i&&(i=a[1]);return new At(o,r,e-o,i-r)}function ht(t){let o=1/0,e=-1/0,r=1/0,i=-1/0;for(const l of t)for(const a of l)a[0]<o&&(o=a[0]),a[0]>e&&(e=a[0]),a[1]<r&&(r=a[1]),a[1]>i&&(i=a[1]);return[o,r,e,i]}function Nt(t){return t?t.rings?ht(t.rings):t.paths?ht(t.paths):xt(t)?[t.xmin,t.ymin,t.xmax,t.ymax]:null:null}function Ct(t,o,e,r,i){const[l,a,n,s]=t;if(n<l||s<a)return[0,0,0];const c=n-l,f=s-a,p=128,m=1,u=Math.floor(.5*(.5*p-m)),h=(p-2*(u+m))/Math.max(c,f),y=Math.round(c*h)+2*u,d=Math.round(f*h)+2*u;let S=1;o&&(S=d/h/(o.ymax-o.ymin));let N=0,b=0;if(r)if(i){if(o&&e&&o.ymax-o.ymin>0){const v=(o.xmax-o.xmin)/(o.ymax-o.ymin);N=r.x/(e*v),b=r.y/e}}else N=r.x,b=r.y;return N=.5*(o.xmax+o.xmin)+N*(o.xmax-o.xmin),b=.5*(o.ymax+o.ymin)+b*(o.ymax-o.ymin),N-=l,b-=a,N*=h,b*=h,N+=u,b+=u,[S,N/y-.5,-(b/d-.5)]}function Le(t){const o=Dt(t.geom),e=Gt(o),r=128,i=1,l=Math.floor(.5*(.5*r-i)),a=(r-2*(l+i))/Math.max(e.width,e.height),n=Math.round(e.width*a)+2*l,s=Math.round(e.height*a)+2*l,c=[];for(const p of o)if(p&&p.length>1){const m=[];for(const u of p){let[h,y]=u;h-=e.x,y-=e.y,h*=a,y*=a,h+=l-.5,y+=l-.5,t.asFill?m.push([h,y]):m.push([Math.round(h),Math.round(y)])}if(t.asFill){const u=m.length-1;m[0][0]===m[u][0]&&m[0][1]===m[u][1]||m.push(m[0])}c.push(m)}const f=Ut(c,n,s,l);return t.asFill&&jt(c,n,s,l,f),[Bt(f,l),n,s]}function Ut(t,o,e,r){const i=o*e,l=new Array(i),a=r*r+1;for(let n=0;n<i;++n)l[n]=a;for(const n of t){const s=n.length;for(let c=1;c<s;++c){const f=n[c-1],p=n[c];let m,u,h,y;f[0]<p[0]?(m=f[0],u=p[0]):(m=p[0],u=f[0]),f[1]<p[1]?(h=f[1],y=p[1]):(h=p[1],y=f[1]);let d=Math.floor(m)-r,S=Math.floor(u)+r,N=Math.floor(h)-r,b=Math.floor(y)+r;d<0&&(d=0),S>o&&(S=o),N<0&&(N=0),b>e&&(b=e);const v=p[0]-f[0],k=p[1]-f[1],X=v*v+k*k;for(let x=d;x<S;x++)for(let I=N;I<b;I++){let w,O,M=(x-f[0])*v+(I-f[1])*k;M<0?(w=f[0],O=f[1]):M>X?(w=p[0],O=p[1]):(M/=X,w=f[0]+M*v,O=f[1]+M*k);const L=(x-w)*(x-w)+(I-O)*(I-O),J=(e-I-1)*o+x;L<l[J]&&(l[J]=L)}}}for(let n=0;n<i;++n)l[n]=Math.sqrt(l[n]);return l}function jt(t,o,e,r,i){for(const l of t){const a=l.length;for(let n=1;n<a;++n){const s=l[n-1],c=l[n];let f,p,m,u;s[0]<c[0]?(f=s[0],p=c[0]):(f=c[0],p=s[0]),s[1]<c[1]?(m=s[1],u=c[1]):(m=c[1],u=s[1]);let h=Math.floor(f),y=Math.floor(p)+1,d=Math.floor(m),S=Math.floor(u)+1;h<r&&(h=r),y>o-r&&(y=o-r),d<r&&(d=r),S>e-r&&(S=e-r);for(let N=d;N<S;++N){if(s[1]>N==c[1]>N)continue;const b=(e-N-1)*o;for(let v=h;v<y;++v)v<(c[0]-s[0])*(N-s[1])/(c[1]-s[1])+s[0]&&(i[b+v]=-i[b+v]);for(let v=r;v<h;++v)i[b+v]=-i[b+v]}}}}function Bt(t,o){const e=2*o,r=t.length,i=new Uint8Array(4*r);for(let l=0;l<r;++l){const a=.5-t[l]/e;Ft(a,i,4*l)}return i}const qt=96/72;class gt{static executeEffects(o,e,r){const i=zt(e),l=qt;let a=new yt(i);for(const n of o){const s=pt(n);s&&(a=s.execute(a,n,l,r))}return a}static next(o){const e=o.next();return Rt(e),e}static applyEffects(o,e,r){if(!o)return e;let i=new yt(e);for(const n of o){const s=pt(n);s&&(i=s.execute(i,n,1,r))}let l,a=null;for(;l=i.next();)a?mt(a)?mt(l)&&a.paths.push(...l.paths):ut(a)&&ut(l)&&a.rings.push(...l.rings):a=l;return a}}function Ot(t){const o=t.toLowerCase().split(" ").join("-");switch(o){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return o}}function Ie(t){const o=Vt(t)+Zt(t);return Ot(t.family)+(o.length>0?o:"-regular")}function Vt(t){if(!t.weight)return"";switch(t.weight.toLowerCase()){case"bold":case"bolder":return"-bold"}return""}function Zt(t){if(!t.style)return"";switch(t.style.toLowerCase()){case"italic":case"oblique":return"-italic"}return""}function Kt(t,o){let e;if(typeof t=="string")e=P(t+`-seed(${o})`);else{let r=12;e=t^o;do e=107*(e>>8^e)+r|0;while(--r!=0)}return(1+e/(1<<31))/2}function Qt(t){return Math.floor(Kt(t,_t)*te)}const _t=53290320,te=10,nt=wt.getLogger("esri.symbols.cim.cimAnalyzer");function lt(t){switch(t){case"Butt":return tt.BUTT;case"Square":return tt.SQUARE;default:return tt.ROUND}}function at(t){switch(t){case"Bevel":return et.BEVEL;case"Miter":return et.MITER;default:return et.ROUND}}function ee(t){switch(t){case"Left":default:return"left";case"Right":return"right";case"Center":return"center";case"Justify":return nt.warnOnce("Horizontal alignment 'justify' is not implemented. Falling back to 'center'."),"center"}}function oe(t){switch(t){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function ie(t){let o="",e="";if(t){const r=t.toLowerCase();r.includes("italic")?o="italic":r.includes("oblique")&&(o="oblique"),r.includes("bold")?e="bold":r.includes("light")&&(e="lighter")}return{style:o,weight:e}}function re(t){return t.underline?"underline":t.strikethrough?"line-through":"none"}function dt(t,o,e,r){let i;t[o]?i=t[o]:(i={},t[o]=i),i[e]=r}function St(t){const o=t.markerPlacement;return o&&o.angleToLine?it.MAP:it.SCREEN}async function $e(t,o,e,r,i){const l=r!=null?r:[];if(!t)return l;let a,n;const s={};if(t.type!=="CIMSymbolReference")return nt.error("Expect cim type to be 'CIMSymbolReference'"),l;if(a=t.symbol,n=t.primitiveOverrides,n){const f=[];for(const p of n){const m=p.valueExpressionInfo;if(m&&o){const u=m.expression,h=It(u,o.spatialReference,o.fields).then(y=>{y&&dt(s,p.primitiveName,p.propertyName,y)});f.push(h)}else p.value!=null&&dt(s,p.primitiveName,p.propertyName,p.value)}f.length>0&&await Promise.all(f)}const c=[];switch(Mt(a,e,c),c.length>0&&await Promise.all(c),a.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":ne(a,n,s,o,l,e,i)}return l}function ne(t,o,e,r,i,l,a){if(!t)return;const n=t.symbolLayers;if(!n)return;const s=t.effects;let c;const f=R.getSize(t);t.type==="CIMPointSymbol"&&t.angleAlignment==="Map"&&(c=it.MAP);let p=n.length;for(;p--;){const m=n[p];if(!m||m.enable===!1)continue;let u;s&&s.length&&(u=[...s]);const h=m.effects;h&&h.length&&(s?u.push(...h):u=[...h]);const y=[];let d;j.findEffectOverrides(u,o,y),d=y.length>0?ve(u,y,e,r):u;const S=[];switch(j.findApplicableOverrides(m,o,S),m.type){case"CIMSolidFill":le(m,d,e,S,r,i);break;case"CIMPictureFill":ae(m,d,e,S,r,l,i);break;case"CIMHatchFill":se(m,d,e,S,r,i);break;case"CIMGradientFill":ce(m,d,e,S,r,i);break;case"CIMSolidStroke":fe(m,d,e,S,r,i,t.type==="CIMPolygonSymbol",f);break;case"CIMPictureStroke":me(m,d,e,S,r,i,t.type==="CIMPolygonSymbol",f);break;case"CIMGradientStroke":ue(m,d,e,S,r,i,t.type==="CIMPolygonSymbol",f);break;case"CIMCharacterMarker":if(ot(m,d,e,S,r,i))break;break;case"CIMPictureMarker":if(ot(m,d,e,S,r,i))break;t.type==="CIMLineSymbol"&&(c=St(m)),pe(m,d,e,S,r,l,i,c,f);break;case"CIMVectorMarker":if(ot(m,d,e,S,r,i))break;t.type==="CIMLineSymbol"&&(c=St(m)),ye(m,d,e,S,r,i,l,c,f,a);break;default:nt.error("Cannot analyze CIM layer",m.type)}}}function le(t,o,e,r,i,l){const a=t.primitiveName,n=z(t.color),[s,c]=Y(r,a,o,null,null),f=P(JSON.stringify(t)+c).toString();l.push({type:"fill",templateHash:f,materialHash:s?()=>f:f,cim:t,materialOverrides:null,colorLocked:t.colorLocked,color:g(a,e,"Color",i,n,H),height:0,angle:0,offsetX:0,offsetY:0,scaleX:1,effects:o,applyRandomOffset:!1,sampleAlphaOnly:!0})}function ae(t,o,e,r,i,l,a){const n=t.primitiveName,s=t.tintColor?z(t.tintColor):{r:255,g:255,b:255,a:1},[c,f]=Y(r,n,o,null,null),p=P(JSON.stringify(t)+f).toString(),m=P(`${t.url}${JSON.stringify(t.colorSubstitutions)}`).toString();let u=C(t.scaleX);if("width"in t){const h=t.width;let y=1;const d=l.getResource(t.url);E(d)&&(y=d.width/d.height),u/=y*(t.height/h)}a.push({type:"fill",templateHash:p,materialHash:c?()=>m:m,cim:t,materialOverrides:null,colorLocked:t.colorLocked,effects:o,color:g(n,e,"TintColor",i,s,H),height:g(n,e,"Height",i,t.height),scaleX:g(n,e,"ScaleX",i,u),angle:g(n,e,"Rotation",i,C(t.rotation)),offsetX:g(n,e,"OffsetX",i,C(t.offsetX)),offsetY:g(n,e,"OffsetY",i,C(t.offsetY)),url:t.url,applyRandomOffset:!1,sampleAlphaOnly:!1})}function se(t,o,e,r,i,l){var h;const a=["Rotation","OffsetX","OffsetY"],n=r.filter(y=>y.primitiveName!==t.primitiveName&&!a.includes(y.propertyName)),s=t.primitiveName,[c,f]=Y(r,s,o,null,null),p=P(JSON.stringify(t)+f).toString(),m=P(`${t.separation}${JSON.stringify(t.lineSymbol)}`).toString();let u={r:255,g:255,b:255,a:1};if(t.lineSymbol){const y=(h=t.lineSymbol)==null?void 0:h.symbolLayers.find(d=>d.type==="CIMSolidStroke");y&&(u=z(y.color))}l.push({type:"fill",templateHash:p,materialHash:c?K(m,e,n,i):m,cim:t,materialOverrides:n,colorLocked:t.colorLocked,effects:o,color:u,height:g(s,e,"Separation",i,t.separation),scaleX:1,angle:g(s,e,"Rotation",i,C(t.rotation)),offsetX:g(s,e,"OffsetX",i,C(t.offsetX)),offsetY:g(s,e,"OffsetY",i,C(t.offsetY)),applyRandomOffset:!1,sampleAlphaOnly:!0})}function ce(t,o,e,r,i,l){const a=t.primitiveName,[n,s]=Y(r,a,o,null,null),c=P(JSON.stringify(t)+s).toString();l.push({type:"fill",templateHash:c,materialHash:n?K(c,e,r,i):c,cim:t,materialOverrides:null,colorLocked:t.colorLocked,effects:o,color:{r:128,g:128,b:128,a:1},height:0,angle:0,offsetX:0,offsetY:0,scaleX:1,applyRandomOffset:!1,sampleAlphaOnly:!1})}function fe(t,o,e,r,i,l,a,n){const s=t.primitiveName,c=z(t.color),f=t.width!==void 0?t.width:4,p=lt(t.capStyle),m=at(t.joinStyle),u=t.miterLimit,[h,y]=Y(r,s,o,null,null),d=P(JSON.stringify(t)+y).toString();let S,N;if(o&&o instanceof Array&&o.length>0){const b=o[o.length-1];if(b.type==="CIMGeometricEffectDashes"&&b.lineDashEnding==="NoConstraint"&&b.offsetAlongLine===null){const v=(o=[...o]).pop();S=v.dashTemplate,N=v.scaleDash}}l.push({type:"line",templateHash:d,materialHash:h?()=>d:d,cim:t,materialOverrides:null,isOutline:a,colorLocked:t.colorLocked,effects:o,color:g(s,e,"Color",i,c,H),width:g(s,e,"Width",i,f),cap:g(s,e,"CapStyle",i,p),join:g(s,e,"JoinStyle",i,m),miterLimit:g(s,e,"MiterLimit",i,u),referenceWidth:n,zOrder:st(t.name),dashTemplate:S,scaleDash:N,sampleAlphaOnly:!0})}function me(t,o,e,r,i,l,a,n){const s=P(`${t.url}${JSON.stringify(t.colorSubstitutions)}`).toString(),c=t.primitiveName,f=z(t.tintColor),p=t.width!==void 0?t.width:4,m=lt(t.capStyle),u=at(t.joinStyle),h=t.miterLimit,[y,d]=Y(r,c,o,null,null),S=P(JSON.stringify(t)+d).toString();l.push({type:"line",templateHash:S,materialHash:y?()=>s:s,cim:t,materialOverrides:null,isOutline:a,colorLocked:t.colorLocked,effects:o,color:g(c,e,"TintColor",i,f,H),width:g(c,e,"Width",i,p),cap:g(c,e,"CapStyle",i,m),join:g(c,e,"JoinStyle",i,u),miterLimit:g(c,e,"MiterLimit",i,h),referenceWidth:n,zOrder:st(t.name),dashTemplate:null,scaleDash:!1,url:t.url,sampleAlphaOnly:!1})}function ue(t,o,e,r,i,l,a,n){const s=t.primitiveName,c=t.width!==void 0?t.width:4,f=lt(t.capStyle),p=at(t.joinStyle),m=t.miterLimit,[u,h]=Y(r,s,o,null,null),y=P(JSON.stringify(t)+h).toString();l.push({type:"line",templateHash:y,materialHash:u?K(y,e,r,i):y,cim:t,materialOverrides:null,isOutline:a,colorLocked:t.colorLocked,effects:o,color:{r:128,g:128,b:128,a:1},width:g(s,e,"Width",i,c),cap:g(s,e,"CapStyle",i,f),join:g(s,e,"JoinStyle",i,p),miterLimit:g(s,e,"MiterLimit",i,m),referenceWidth:n,zOrder:st(t.name),dashTemplate:null,scaleDash:!1,sampleAlphaOnly:!1})}function ot(t,o,e,r,i,l){const a=t.markerPlacement;if(!a||a.type!=="CIMMarkerPlacementInsidePolygon")return!1;const n=a,s=Math.abs(n.stepX),c=Math.abs(n.stepY);if(s===0||c===0)return!0;const f=["Rotation","OffsetX","OffsetY"],p=r.filter(v=>v.primitiveName!==t.primitiveName&&!f.includes(v.propertyName)),m="url"in t?t.url:null,[u,h]=Y(r,n.primitiveName,o,null,null),y=P(JSON.stringify(t)+h).toString();let d,S,N=null;if(a.gridType==="Random"){const v=Xt(Tt),k=Math.max(Math.floor(v/s),1),X=Math.max(Math.floor(v/c),1);d=c*X,N=x=>x?x*X:0,S=k*s/d}else a.shiftOddRows?(d=2*c,N=v=>v?2*v:0,S=s/c*.5):(d=c,N=null,S=s/c);let b={r:255,g:255,b:255,a:1};return"tintColor"in t&&(b=z(t.tintColor)),l.push({type:"fill",templateHash:y,materialHash:u?K(y,e,p,i):y,cim:t,materialOverrides:p,colorLocked:t.colorLocked,effects:o,color:g(n.primitiveName,e,"TintColor",i,b,H),height:g(n.primitiveName,e,"StepY",i,d,N),scaleX:S,angle:g(n.primitiveName,e,"GridAngle",i,n.gridAngle),offsetX:g(n.primitiveName,e,"OffsetX",i,C(n.offsetX)),offsetY:g(n.primitiveName,e,"OffsetY",i,C(n.offsetY)),url:m,applyRandomOffset:a.gridType==="Random",sampleAlphaOnly:!m}),!0}function pe(t,o,e,r,i,l,a,n,s){var w;const c=t.primitiveName,f=C(t.size);let p=C(t.scaleX);const m=C(t.rotation),u=C(t.offsetX),h=C(t.offsetY),y=t.tintColor?z(t.tintColor):{r:255,g:255,b:255,a:1},d=P(`${t.url}${JSON.stringify(t.colorSubstitutions)}${JSON.stringify(t.animatedSymbolProperties)}`).toString(),S=kt(t.markerPlacement,r,e,i),N=be(t.animatedSymbolProperties,r,e,i),[b,v]=Y(r,c,o,S,N),k=P(JSON.stringify(t)+v).toString(),X=(w=t.anchorPoint)!=null?w:{x:0,y:0};if("width"in t){const O=t.width;let M=1;const L=l.getResource(t.url);E(L)&&(M=L.width/L.height),p/=M*(f/O)}function x(O,M){return bt(N,O,M)}const I=t.animatedSymbolProperties&&t.animatedSymbolProperties.randomizeStartTime===!0?(O,M,L,J)=>{const F=Qt(J),T=x(O,M);return d+`-MATERIALGROUP(${F})-ASP(${JSON.stringify(T)})`}:b?(O,M)=>{const L=x(O,M);return d+`-ASP(${JSON.stringify(L)})`}:d;a.push({type:"marker",templateHash:k,materialHash:I,cim:t,materialOverrides:null,colorLocked:t.colorLocked,effects:o,scaleSymbolsProportionally:!1,alignment:n,size:g(c,e,"Size",i,f),scaleX:g(c,e,"ScaleX",i,p),rotation:g(c,e,"Rotation",i,m),offsetX:g(c,e,"OffsetX",i,u),offsetY:g(c,e,"OffsetY",i,h),color:g(c,e,"TintColor",i,y,H),anchorPoint:{x:X.x,y:-X.y},isAbsoluteAnchorPoint:t.anchorPointUnits!=="Relative",outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,frameHeight:0,rotateClockwise:t.rotateClockwise,referenceSize:s,sizeRatio:1,markerPlacement:S,url:t.url,animatedSymbolProperties:N})}function ye(t,o,e,r,i,l,a,n,s,c){const f=t.markerGraphics;if(!f)return;let p=0;if(t.scaleSymbolsProportionally){const u=t.frame;u&&(p=u.ymax-u.ymin)}const m=kt(t.markerPlacement,r,e,i);for(const u of f)if(u){const h=u.symbol;if(!h)continue;switch(h.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":ge(t,o,m,null,u,r,e,i,l,a,n,s,p,c);break;case"CIMTextSymbol":he(t,o,m,u,e,r,i,l,n,s,p)}}}function he(t,o,e,r,i,l,a,n,s,c,f){const p=[];j.findApplicableOverrides(r,l,p);const m=r.geometry;if(!("x"in m)||!("y"in m))return;const u=r.symbol,h=re(u),y=ie(u.fontStyleName),d=Ot(u.fontFamilyName);u.font={family:d,decoration:h,...y};const S=t.frame,N=m.x-.5*(S.xmin+S.xmax),b=m.y-.5*(S.ymin+S.ymax),v=t.size/f,k=t.primitiveName,X=C(u.height)*v,x=C(u.angle),I=C(t.offsetX)+(C(u.offsetX)+N)*v,w=C(t.offsetY)+(C(u.offsetY)+b)*v,O=z(R.getFillColor(u));let M=z(R.getStrokeColor(u)),L=R.getStrokeWidth(u);L||(M=z(R.getFillColor(u.haloSymbol)),L=u.haloSize*v);const[J,F]=Y(l,k,o,e,null),T=JSON.stringify(t.effects)+Number(t.colorLocked)+JSON.stringify(t.anchorPoint)+t.anchorPointUnits+JSON.stringify(t.markerPlacement),W=P(JSON.stringify(r)+T+F).toString();let $=g(r.primitiveName,i,"TextString",a,r.textString,Jt,u.textCase);if($==null)return;const{fontStyleName:B}=u,D=d+(B?"-"+B.toLowerCase():"-regular"),G=D;typeof $=="string"&&$.includes("[")&&u.fieldMap&&($=Ht(u.fieldMap,$,u.textCase)),n.push({type:"text",templateHash:W,materialHash:J||typeof $=="function"||$.match(/\[(.*?)\]/)?(A,Q,_)=>G+"-"+bt($,A,Q,_):G+"-"+P($),cim:u,materialOverrides:null,colorLocked:t.colorLocked,effects:o,alignment:s,anchorPoint:{x:t.anchorPoint?t.anchorPoint.x:0,y:t.anchorPoint?t.anchorPoint.y:0},isAbsoluteAnchorPoint:t.anchorPointUnits!=="Relative",fontName:D,decoration:h,weight:g(k,i,"Weight",a,y.weight),style:g(k,i,"Size",a,y.style),size:g(k,i,"Size",a,X),angle:g(k,i,"Rotation",a,x),offsetX:g(k,i,"OffsetX",a,I),offsetY:g(k,i,"OffsetY",a,w),horizontalAlignment:ee(u.horizontalAlignment),verticalAlignment:oe(u.verticalAlignment),text:$,color:O,outlineColor:M,outlineSize:L,referenceSize:c,sizeRatio:1,markerPlacement:e})}function ge(t,o,e,r,i,l,a,n,s,c,f,p,m,u){var N;const h=i.symbol,y=h.symbolLayers;if(!y)return;if(u)return void vt(t,o,e,r,i,a,l,n,s,c,f,p,m);let d=y.length;if(Ne(y))return void de(t,o,e,r,i,y,l,a,n,s,f,p,m);const S=gt.applyEffects(h.effects,i.geometry,c.geometryEngine);if(S)for(;d--;){const b=y[d];if(b&&b.enable!==!1)switch(b.type){case"CIMSolidFill":case"CIMSolidStroke":{const v=gt.applyEffects(b.effects,S,c.geometryEngine),k=Nt(v);if(!k)continue;const[X,x,I]=Ct(k,t.frame,t.size,t.anchorPoint,t.anchorPointUnits!=="Relative"),w=b.type==="CIMSolidFill",O={type:"sdf",geom:v,asFill:w},M=t.primitiveName,L=(N=C(t.size))!=null?N:10,J=C(t.rotation),F=C(t.offsetX),T=C(t.offsetY),W=b.path,$=b.primitiveName,B=z(w?R.getFillColor(b):R.getStrokeColor(b)),D=w?{r:0,g:0,b:0,a:0}:z(R.getStrokeColor(b)),G=R.getStrokeWidth(b);if(!w&&!G)break;let A=!1,Q="";for(const U of l)U.primitiveName!==$&&U.primitiveName!==M||(U.value!==void 0?Q+=`-${U.primitiveName}-${U.propertyName}-${JSON.stringify(U.value)}`:U.valueExpressionInfo&&(A=!0));E(o)&&typeof o=="function"&&(A=!0);const _=JSON.stringify({...t,markerGraphics:null}),ft=P(JSON.stringify(O)+W).toString(),Pt={type:"marker",templateHash:P(JSON.stringify(i)+JSON.stringify(b)+_+Q).toString(),materialHash:A?()=>ft:ft,cim:O,materialOverrides:null,colorLocked:t.colorLocked,effects:o,scaleSymbolsProportionally:t.scaleSymbolsProportionally,alignment:f,anchorPoint:{x,y:I},isAbsoluteAnchorPoint:!1,size:g(t.primitiveName,a,"Size",n,L),rotation:g(t.primitiveName,a,"Rotation",n,J),offsetX:g(t.primitiveName,a,"OffsetX",n,F),offsetY:g(t.primitiveName,a,"OffsetY",n,T),scaleX:1,frameHeight:m,rotateClockwise:t.rotateClockwise,referenceSize:p,sizeRatio:X,color:g($,a,"Color",n,B,H),outlineColor:g($,a,"Color",n,D,H),outlineWidth:g($,a,"Width",n,G),markerPlacement:e,animatedSymbolProperties:r,path:W};s.push(Pt);break}default:vt(t,o,e,r,i,a,l,n,s,c,f,p,m)}}}function de(t,o,e,r,i,l,a,n,s,c,f,p,m){const u=i.geometry,h=l[0],y=l[1],d=Nt(u);if(!d)return;const[S,N,b]=Ct(d,t.frame,t.size,t.anchorPoint,t.anchorPointUnits!=="Relative"),v={type:"sdf",geom:u,asFill:!0},k=t.primitiveName,X=C(t.size),x=C(t.rotation),I=C(t.offsetX),w=C(t.offsetY),O=y.path,M=y.primitiveName,L=h.primitiveName,J=z(R.getFillColor(y)),F=z(R.getStrokeColor(h)),T=R.getStrokeWidth(h);let W=!1,$="";for(const A of a)A.primitiveName!==M&&A.primitiveName!==L&&A.primitiveName!==k||(A.value!==void 0?$+=`-${A.primitiveName}-${A.propertyName}-${JSON.stringify(A.value)}`:A.valueExpressionInfo&&(W=!0));const B=JSON.stringify({...t,markerGraphics:null}),D=P(JSON.stringify(v)+O).toString(),G={type:"marker",templateHash:P(JSON.stringify(i)+JSON.stringify(y)+JSON.stringify(h)+B+$).toString(),materialHash:W?()=>D:D,cim:v,materialOverrides:null,colorLocked:t.colorLocked,effects:o,scaleSymbolsProportionally:t.scaleSymbolsProportionally,alignment:f,anchorPoint:{x:N,y:b},isAbsoluteAnchorPoint:!1,size:g(t.primitiveName,n,"Size",s,X),rotation:g(t.primitiveName,n,"Rotation",s,x),offsetX:g(t.primitiveName,n,"OffsetX",s,I),offsetY:g(t.primitiveName,n,"OffsetY",s,w),scaleX:1,frameHeight:m,rotateClockwise:t.rotateClockwise,referenceSize:p,sizeRatio:S,color:g(M,n,"Color",s,J,H),outlineColor:g(L,n,"Color",s,F,H),outlineWidth:g(L,n,"Width",s,T),markerPlacement:e,path:O,animatedSymbolProperties:r};c.push(G)}function vt(t,o,e,r,i,l,a,n,s,c,f,p,m){const u=Se(t,i);let h=[];const y=["Rotation","OffsetX","OffsetY"];h=a.filter(O=>O.primitiveName!==t.primitiveName||!y.includes(O.propertyName));let d="";for(const O of a)O.value!==void 0&&(d+=`-${O.primitiveName}-${O.propertyName}-${JSON.stringify(O.value)}`);const[S,N,b]=R.getTextureAnchor(u,c),v=t.primitiveName,k=C(t.rotation),X=C(t.offsetX),x=C(t.offsetY),I=P(JSON.stringify(u)+d).toString(),w={type:"marker",templateHash:I,materialHash:h.length>0||E(o)&&typeof o=="function"?K(I,l,h,n):I,cim:u,materialOverrides:h,colorLocked:t.colorLocked,effects:o,scaleSymbolsProportionally:t.scaleSymbolsProportionally,alignment:f,anchorPoint:{x:S,y:N},isAbsoluteAnchorPoint:!1,size:t.size,rotation:g(v,l,"Rotation",n,k),offsetX:g(v,l,"OffsetX",n,X),offsetY:g(v,l,"OffsetY",n,x),color:{r:255,g:255,b:255,a:1},outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,scaleX:1,frameHeight:m,rotateClockwise:t.rotateClockwise,referenceSize:p,sizeRatio:b/Lt(t.size),markerPlacement:e,animatedSymbolProperties:r};s.push(w)}function Se(t,o){return{type:t.type,enable:!0,name:t.name,colorLocked:t.colorLocked,primitiveName:t.primitiveName,anchorPoint:t.anchorPoint,anchorPointUnits:t.anchorPointUnits,offsetX:0,offsetY:0,rotateClockwise:t.rotateClockwise,rotation:0,size:t.size,billboardMode3D:t.billboardMode3D,depth3D:t.depth3D,frame:t.frame,markerGraphics:[o],scaleSymbolsProportionally:t.scaleSymbolsProportionally,respectFrame:t.respectFrame,clippingPath:t.clippingPath}}function st(t){if(t&&t.indexOf("Level_")===0){const o=parseInt(t.substr(6),10);if(!isNaN(o))return o}return 0}function H(t){if(!t||t.length===0)return null;const o=new $t(t).toRgba();return{r:o[0],g:o[1],b:o[2],a:o[3]}}function g(t,o,e,r,i,l,a){const n=o[t];if(n){const s=n[e];if(typeof s=="string"||typeof s=="number"||s instanceof Array)return l?l.call(null,s,a):s;if(s!=null&&s instanceof V)return(c,f,p)=>{let m=Z(s,c,{$view:p},r.geometryType,f);return m!==null&&l&&(m=l.call(null,m,a)),m!==null?m:i}}return i}function ct(t){return t&&t.charAt(0).toLowerCase()+t.substr(1)}function ve(t,o,e,r){for(const i of o)if(i.valueExpressionInfo){const l=e[i.primitiveName]&&e[i.primitiveName][i.propertyName];l instanceof V&&(i.fn=(a,n,s)=>Z(l,a,{$view:s},r.geometryType,n))}return(i,l,a)=>{for(const s of o)s.fn&&(s.value=s.fn(i,l,a));const n=[];for(let s of t){const c=s==null?void 0:s.primitiveName;if(c){let f=!1;for(const p of o)if(p.primitiveName===c){const m=ct(p.propertyName);p.value!=null&&p.value!==s[m]&&(f||(s=rt(s),f=!0),s[m]=p.value)}}n.push(s)}return n}}function kt(t,o,e,r){const i=[];if(j.findApplicableOverrides(t,o,i),i.length===0)return t;for(const l of i)if(l.valueExpressionInfo){const a=e[l.primitiveName]&&e[l.primitiveName][l.propertyName];a instanceof V&&(l.fn=(n,s,c)=>Z(a,n,{$view:c},r.geometryType,s))}return(l,a,n)=>{for(const f of i)f.fn&&(f.value=f.fn(l,a,n));const s=rt(t),c=t.primitiveName;for(const f of i)if(f.primitiveName===c){const p=ct(f.propertyName);f.value!=null&&f.value!==s[p]&&(s[p]=f.value)}return s}}function be(t,o,e,r){const i=[];if(j.findApplicableOverrides(t,o,i),i.length===0)return t;for(const l of i)if(l.valueExpressionInfo){const a=e[l.primitiveName]&&e[l.primitiveName][l.propertyName];a instanceof V&&(l.fn=(n,s,c)=>Z(a,n,{$view:c},r.geometryType,s))}return(l,a,n)=>{for(const f of i)f.fn&&(f.value=f.fn(l,a,n));const s=rt(t),c=t.primitiveName;for(const f of i)if(f.primitiveName===c){const p=ct(f.propertyName);f.value!=null&&f.value!==s[p]&&(s[p]=f.value)}return s}}function K(t,o,e,r){for(const i of e)if(i.valueExpressionInfo){const l=o[i.primitiveName]&&o[i.primitiveName][i.propertyName];l instanceof V&&(i.fn=(a,n,s)=>Z(l,a,{$view:s},r.geometryType,n))}return(i,l,a)=>{for(const n of e)n.fn&&(n.value=n.fn(i,l,a));return P(t+j.buildOverrideKey(e)).toString()}}function Xe(t,o){if(!o||o.length===0)return t;const e=JSON.parse(JSON.stringify(t));return j.applyOverrides(e,o),e}function Y(t,o,e,r,i){let l=!1,a="";for(const n of t)n.primitiveName===o&&(n.value!==void 0?a+=`-${n.primitiveName}-${n.propertyName}-${JSON.stringify(n.value)}`:n.valueExpressionInfo&&(l=!0));return E(e)&&typeof e=="function"&&(l=!0),E(r)&&typeof r=="function"&&(l=!0),E(i)&&typeof i=="function"&&(l=!0),[l,a]}function Mt(t,o,e){if(t&&o)switch(t.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const r=t.symbolLayers;if(!r)return;for(const i of r)switch(Ce(i,o,e),i.type){case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":case"CIMPictureStroke":case"CIMGradientStroke":case"CIMCharacterMarker":case"CIMPictureMarker":"url"in i&&i.url&&e.push(o.fetchResource(i.url,null));break;case"CIMVectorMarker":{const l=i.markerGraphics;if(!l)continue;for(const a of l)if(a){const n=a.symbol;n&&Mt(n,o,e)}}}}}}const Ne=t=>t&&t.length===2&&t[0].enable&&t[1].enable&&t[0].type==="CIMSolidStroke"&&t[1].type==="CIMSolidFill"&&!t[0].effects&&!t[1].effects;let q;function Ce(t,o,e){if(!(!t.effects||E(o.geometryEngine))){if(q)return void e.push(q);Yt(t.effects)&&(q=Et(),e.push(q),q.then(r=>o.geometryEngine=r))}}export{$e as Y,Le as a,Kt as e,gt as f,Ie as n,Qt as o,Wt as r,Xe as s};
